# æˆ‘å¥¥ç¯®çƒè§†é¢‘æ•°æ®æå–å™¨ ğŸ€



## ğŸ“¢ é¡¹ç›®ç®€ä»‹

æˆ‘å¥¥ç¯®çƒè§†é¢‘æ•°æ®æå–å™¨æ˜¯ä¸€æ¬¾ä¸“ä¸ºç¯®çƒçˆ±å¥½è€…ã€æ•™ç»ƒå’Œåˆ†æå¸ˆè®¾è®¡çš„å¼ºå¤§å·¥å…·ã€‚å®ƒèƒ½å¤Ÿä»æˆ‘å¥¥ç¯®çƒå¹³å°è½»æ¾æå–æ¯”èµ›å›æ”¾ã€ç²¾å½©é›†é”¦ç­‰è§†é¢‘æ•°æ®ï¼Œè®©æ‚¨çš„ç¯®çƒè§‚èµ›å’Œåˆ†æä½“éªŒæ›´ä¸Šä¸€å±‚æ¥¼ã€‚

### ğŸŒŸ ä¸»è¦ç‰¹æ€§

- **è‡ªåŠ¨æå–**: æ™ºèƒ½è·å–æˆ‘å¥¥ç¯®çƒå¹³å°çš„æ¯”èµ›è§†é¢‘å’Œå›æ”¾é“¾æ¥
- **ä¸€é”®å¤åˆ¶**: è½»æ¾å¤åˆ¶è§†é¢‘é“¾æ¥ï¼Œæ–¹ä¾¿åˆ†äº«æˆ–ä¿å­˜
- **è¯¦ç»†ä¿¡æ¯**: æ˜¾ç¤ºè§†é¢‘æ—¶é•¿ã€åˆ›å»ºæ—¶é—´å’Œæœ‰æ•ˆæœŸç­‰å…³é”®ä¿¡æ¯
- **ç”¨æˆ·å‹å¥½**: ç®€æ´çš„ç•Œé¢è®¾è®¡ï¼Œæ“ä½œç›´è§‚æ˜“ç”¨
- **é«˜å¯é æ€§**: é‡‡ç”¨åŒé‡æ•°æ®è·å–æœºåˆ¶ï¼Œç¡®ä¿ç¨³å®šæ€§

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. ç¡®ä¿æ‚¨çš„æµè§ˆå™¨å·²å®‰è£… Tampermonkey æ’ä»¶ã€‚
2. ç‚¹å‡» [è¿™é‡Œ](#) å®‰è£…è„šæœ¬ã€‚
3. æ‰“å¼€æˆ‘å¥¥ç¯®çƒçš„æ¯”èµ›è¯¦æƒ…é¡µé¢ã€‚
4. äº«å—ä¾¿æ·çš„è§†é¢‘æ•°æ®æå–ä½“éªŒï¼

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

- **çƒè¿·**: è½»æ¾è·å–æ¯”èµ›å›æ”¾ï¼Œé‡æ¸©ç²¾å½©ç¬é—´
- **æ•™ç»ƒ**: å¿«é€Ÿè®¿é—®å®Œæ•´æ¯”èµ›è§†é¢‘ï¼Œè¿›è¡Œæˆ˜æœ¯åˆ†æ
- **å†…å®¹åˆ›ä½œè€…**: æ–¹ä¾¿åœ°è·å–ç´ æï¼Œåˆ¶ä½œç²¾å½©çš„ç¯®çƒå†…å®¹

## ğŸ“ˆ ä¸ºä»€ä¹ˆé€‰æ‹©æˆ‘ä»¬çš„å·¥å…·ï¼Ÿ

1. **èŠ‚çœæ—¶é—´**: è‡ªåŠ¨åŒ–çš„æ•°æ®æå–è¿‡ç¨‹ï¼Œè®©æ‚¨ä¸“æ³¨äºè§‚çœ‹å’Œåˆ†æ
2. **å¢å¼ºåˆ†æ**: è½»æ¾è·å–å…¨åœºå›æ”¾ï¼Œæ·±å…¥ç ”ç©¶æ¯”èµ›ç»†èŠ‚
3. **æå‡ä½“éªŒ**: ç®€åŒ–è§†é¢‘åˆ†äº«è¿‡ç¨‹ï¼Œå¢å¼ºç¤¾äº¤äº’åŠ¨
4. **ä¿æŠ¤éšç§**: æœ¬åœ°æ•°æ®å¤„ç†ï¼Œç¡®ä¿æ‚¨çš„ä½¿ç”¨ä¹ æƒ¯ä¸è¢«æ³„éœ²

## ğŸ“š æŠ€æœ¯ç»†èŠ‚

- ä½¿ç”¨ JavaScript å¼€å‘
- å…¼å®¹ä¸»æµæµè§ˆå™¨
- é‡‡ç”¨ XHR æ‹¦æˆªæŠ€æœ¯
- æ”¯æŒå¤‡ç”¨ API è°ƒç”¨

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿å¹¶æ„Ÿè°¢ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼å¦‚æœæ‚¨æœ‰ä»»ä½•æ”¹è¿›æ„è§æˆ–é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºæ‚¨çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ‚¨çš„æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºä¸€ä¸ª Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ è”ç³»æˆ‘ä»¬

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿è”ç³»æˆ‘ä»¬ï¼š

- é¡¹ç›®åœ°å€ï¼š[https://github.com/yourusername/woao-basketball-extractor](https://github.com/yourusername/woao-basketball-extractor)
- ç”µå­é‚®ä»¶ï¼šyour.email@example.com

---

ğŸ’– å¦‚æœæ‚¨å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œåˆ«å¿˜äº†ç»™æˆ‘ä»¬ä¸€ä¸ªæ˜Ÿæ ‡ï¼

#æˆ‘å¥¥ç¯®çƒ #ç¯®çƒè§†é¢‘ #å›æ”¾ #æ•°æ®æå– #ç¯®çƒåˆ†æ
### å…¨éƒ¨ä»£ç 

```js
// ==UserScript==
// @name         æˆ‘å¥¥-ç¯®çƒå®Œæ•´ä¼˜åŒ–ç‰ˆç¯®çƒèµ›ç¨‹æ•°æ®æå–å™¨
// @namespace    http://tampermonkey.net/
// @version      1.1
// @description  ä½¿ç”¨XHRåŠ«æŒå’Œå¤‡ç”¨æ–¹æ³•ä»APIä¸­æå–ç¯®çƒèµ›ç¨‹æ•°æ®ï¼Œæä¾›æ›´å¯é çš„æ•°æ®åŠ è½½å’Œä¼˜åŒ–çš„ç”¨æˆ·ä½“éªŒ
// @match        https://m.lanqiu.woaoo.net/schedule/detail*
// @grant        GM_addStyle
// @grant        GM_setClipboard
// @grant        GM_xmlhttpRequest
// ==/UserScript==

(function() {
    'use strict';

    let panelVisible = false;
    let dataContainer = null;
    let scheduleData = null;
    let dataLoaded = false;

    GM_addStyle(`
        #toggleButton, #retryButton {
            position: fixed;
            z-index: 10000;
            padding: 8px 15px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        #toggleButton {
            top: 10px;
            right: 10px;
            background-color: #4CAF50;
        }
        #toggleButton:hover {
            background-color: #45a049;
        }
        #retryButton {
            top: 50px;
            right: 10px;
            background-color: #f0ad4e;
        }
        #retryButton:hover {
            background-color: #ec971f;
        }
        #dataPanel {
            position: fixed;
            top: 90px;
            right: 10px;
            width: 300px;
            max-height: calc(100vh - 110px);
            overflow-y: auto;
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            z-index: 9999;
            font-size: 14px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: none;
        }
        .copyButton {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s, transform 0.1s;
        }
        .copyButton:hover {
            background-color: #0056b3;
        }
        .copyButton:active {
            transform: scale(0.95);
        }
        .copyButton.copied {
            background-color: #28a745;
        }
        .dataItem {
            margin-bottom: 15px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
    `);

    // åŠ«æŒ XHR
    function interceptXHR() {
        const XHR = XMLHttpRequest.prototype;
        const open = XHR.open;
        const send = XHR.send;

        XHR.open = function(method, url) {
            this._url = url;
            return open.apply(this, arguments);
        };

        XHR.send = function() {
            this.addEventListener('load', function() {
                if (this._url.includes('/appapi/scheduleHighlightVideo/getSchedulePlaybackAndHighlights')) {
                    const response = JSON.parse(this.responseText);
                    if (response.code === 200 && response.data) {
                        handleData(response.data);
                    }
                }
            });
            return send.apply(this, arguments);
        };
    }

    // å¤„ç†è·å–åˆ°çš„æ•°æ®
    function handleData(data) {
        if (!dataLoaded) {
            scheduleData = data;
            createDataPanel(scheduleData);
            createToggleButton();
            dataLoaded = true;
            if (document.getElementById('retryButton')) {
                document.getElementById('retryButton').remove();
            }
        }
    }

    // å¤‡ç”¨æ–¹æ³•ï¼šç›´æ¥è·å–æ•°æ®
    function fetchDataDirectly() {
        const scheduleId = extractScheduleId();
        if (scheduleId) {
            const apiUrl = `https://gatewayapi.woaolanqiu.cn/appapi/scheduleHighlightVideo/getSchedulePlaybackAndHighlights?scheduleId=${scheduleId}`;
            GM_xmlhttpRequest({
                method: "GET",
                url: apiUrl,
                onload: function(response) {
                    if (response.status === 200) {
                        const data = JSON.parse(response.responseText);
                        if (data.code === 200 && data.data) {
                            handleData(data.data);
                        } else {
                            console.error('APIè¿”å›é”™è¯¯:', data.message);
                        }
                    } else {
                        console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
                    }
                },
                onerror: function(error) {
                    console.error('è¯·æ±‚å‡ºé”™:', error);
                }
            });
        } else {
            console.error('URLä¸­æœªæ‰¾åˆ°scheduleId');
        }
    }

    // ä»URLä¸­æå–scheduleId
    function extractScheduleId() {
        const url = new URL(window.location.href);
        return url.searchParams.get('scheduleId');
    }

    // æ ¼å¼åŒ–æ—¶é•¿
    function formatDuration(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const remainingSeconds = Math.round(seconds % 60);
        return `${hours > 0 ? hours + 'æ—¶' : ''}${minutes}åˆ†${remainingSeconds}ç§’`;
    }

    // å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard(name, url, button) {
        const copyText = `${name}ï¼š${url}`;
        GM_setClipboard(copyText, 'text');
        button.textContent = 'å·²å¤åˆ¶!';
        button.classList.add('copied');
        setTimeout(() => {
            button.textContent = 'å¤åˆ¶é“¾æ¥';
            button.classList.remove('copied');
        }, 2000);
    }

    // åˆ›å»ºå¹¶æ˜¾ç¤ºæ•°æ®é¢æ¿
    function createDataPanel(data) {
        if (dataContainer) {
            document.body.removeChild(dataContainer);
        }

        dataContainer = document.createElement('div');
        dataContainer.id = 'dataPanel';
        document.body.appendChild(dataContainer);

        let content = '<h2 style="margin-top:0; color: #333;">ç¯®çƒèµ›ç¨‹æ•°æ®</h2>';

        // å¤„ç†æ‰€æœ‰å›æ”¾
        if (data.playbacks && data.playbacks.length > 0) {
            content += '<h3 style="color: #555;">å›æ”¾</h3>';
            data.playbacks.forEach((playback, index) => {
                content += `
                    <div class="dataItem">
                        <p><strong style="color: #333;">${playback.partName}</strong></p>
                        <p style="color: #666;">æ—¶é•¿: ${formatDuration(playback.duration)}</p>
                        <button class="copyButton" onclick="copyToClipboard('${playback.partName}', '${playback.videoUrl}', this)">å¤åˆ¶é“¾æ¥</button>
                    </div>
                `;
            });
        } else {
            content += '<p style="color: #666;">æ²¡æœ‰å¯ç”¨çš„å›æ”¾</p>';
        }

        // å¤„ç†å…¨åœºæ¯”èµ›é›†é”¦
        if (data.wholeHighlightCollection) {
            const highlight = data.wholeHighlightCollection;
            const gameNameAndScore = `${highlight.homeTeamName} ${highlight.homeTeamScore} - ${highlight.awayTeamScore} ${highlight.awayTeamName}`;
            content += `
                <h3 style="color: #555;">å…¨åœºæ¯”èµ›é›†é”¦</h3>
                <div class="dataItem">
                    <p><strong style="color: #333;">${gameNameAndScore}</strong></p>
                    <p style="color: #666;">æ—¶é•¿: ${formatDuration(highlight.duration)}</p>
                    <p style="color: #666;">åˆ›å»ºæ—¶é—´: ${highlight.createTime}</p>
                    <p style="color: #666;">æœ‰æ•ˆæœŸè¿˜å‰©: ${highlight.remainingValidDays}å¤©</p>
                    <button class="copyButton" onclick="copyToClipboard('å…¨åœºæ¯”èµ›é›†é”¦ ${gameNameAndScore}', '${highlight.url}', this)">å¤åˆ¶é“¾æ¥</button>
                </div>
            `;
        } else {
            content += '<p style="color: #666;">æ²¡æœ‰å¯ç”¨çš„å…¨åœºæ¯”èµ›é›†é”¦</p>';
        }

        dataContainer.innerHTML = content;

        // æ·»åŠ å¤åˆ¶åŠŸèƒ½
        unsafeWindow.copyToClipboard = copyToClipboard;
    }

    // åˆ‡æ¢é¢æ¿æ˜¾ç¤º/éšè—
    function togglePanel() {
        if (dataContainer) {
            panelVisible = !panelVisible;
            dataContainer.style.display = panelVisible ? 'block' : 'none';
        }
    }

    // åˆ›å»ºè§¦å‘æŒ‰é’®
    function createToggleButton() {
        if (!document.getElementById('toggleButton')) {
            const button = document.createElement('button');
            button.id = 'toggleButton';
            button.textContent = 'æ˜¾ç¤º/éšè—æ•°æ®';
            button.onclick = togglePanel;
            document.body.appendChild(button);
        }
    }

    // æ·»åŠ é‡è¯•æŒ‰é’®
    function addRetryButton() {
        if (!document.getElementById('retryButton')) {
            const retryButton = document.createElement('button');
            retryButton.id = 'retryButton';
            retryButton.textContent = 'é‡æ–°åŠ è½½æ•°æ®';
            retryButton.onclick = fetchDataDirectly;
            document.body.appendChild(retryButton);
        }
    }

    // ç›´æ¥åŠ«æŒXHR
    interceptXHR();
    // ä¸»å‡½æ•°
    function main() {

        // å¦‚æœ5ç§’åä»æœªåŠ è½½æ•°æ®ï¼Œå°è¯•ç›´æ¥è·å–å¹¶æ·»åŠ é‡è¯•æŒ‰é’®
        setTimeout(() => {
            if (!dataLoaded) {
                fetchDataDirectly();
                addRetryButton();
            }
        }, 5000);
    }

    // å½“é¡µé¢åŠ è½½å®Œæˆæ—¶è¿è¡Œä¸»å‡½æ•°
    window.addEventListener('load', main);
})();
```